@using DoAnTotNghiep.Models;
@using System.Text.RegularExpressions;
@model List<ProgramSemester>;
@{
    ViewData["Title"] = "KhungChuongTrinh";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var lstype = Model.Where(x => x.ModulesTypeID == 8).ToList();  
    var lstype2 = Model.Where(x => x.ModulesTypeID == 6).ToList();
    var lstype3 = Model.Where(x => x.ModulesTypeID == 7).ToList();
    var lstype4 = Model.Where(x => x.ModulesTypeID == 5).ToList();
    var lstype5 = Model.Where(x => x.ModulesTypeID == 1).ToList();
    var lstype6 = Model.Where(x => x.ModulesTypeID == 4).ToList();
    var lstype7 = Model.Where(x => x.ModulesTypeID == 2).ToList();
}

<div class="l-navbar" id="nav-bar">
    <nav class="nav">
        <div>
            <a href="#" class="nav_logo m-l--10">
                <img src="~/images/logo.png" width="35px" height="35px" alt="">
                <span class="nav_logo-name">Quản lý sinh viên</span>
            </a>
            <div class="nav_list">
                <a href="@Url.Action("News", "Home")" class="nav_link">
                    <i title="Bảng tin" class='bx bx-home-alt-2'></i>
                    <span class="nav_name">Bảng tin</span>
                </a>
                <a href="@Url.Action("ChiaSeBieuMau", "Home")" class="nav_link">
                    <i title="Chia sẻ" class='bx bx-message-square-detail nav_icon'></i>
                    <span class="nav_name">Chia sẻ</span>
                </a>
                <div class="dropdown">
                    <button class="dropbtn">
                        <a href="@Url.Action("KetQuaHocTap", "Home")" class="nav_link">
                            <i title="Kết quả học tập" class='bx bx-clipboard'></i>
                            <span class="nav_name">Kết quả học tập</span>
                        </a>
                    </button>
                    <div class="dropdown-contnet">
                        <a href="@Url.Action("KetQuaThi", "Home")"><i title="Kết quả thi" class='bx bx-task'></i> Kết quả thi</a>
                        <a href="@Url.Action("TBChungTichLuy", "Home")"><i title="TB chung tích lũy" class='bx bx-task'></i> TB chung tích lũy</a>
                        <a href="@Url.Action("TBChungHocKy", "Home")"><i title="TB chung học kỳ" class='bx bx-task'></i> TB chung học kỳ</a>
                        <a href="@Url.Action("XetThuTotNghiep", "Home")"><i title="Xét thử tốt nghiệp" class='bx bx-task'></i> Xét thử tốt nghiệp</a>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="dropbtn">
                        <a href="@Url.Action("ThoiKhoaBieu", "Home")" class="nav_link">
                            <i title="Thời khóa biểu" class='bx bx-time-five'></i>
                            <span class="nav_name">Thời khóa biểu</span>
                        </a>
                    </button>
                    <div class="dropdown-contnet">
                        <a href="@Url.Action("LichGiangDay", "Home")"><i title="Lịch giảng dạy" class='bx bx-timer nav_icon_con'></i> Lịch giảng dạy</a>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="dropbtn">
                        <a href="@Url.Action("XemLichThi", "Home" )" class="nav_link">
                            <i title="Lịch thi" class='bx bx-calendar'></i>
                            <span class="nav_name">Lịch thi</span>
                        </a>
                    </button>
                    <div class="dropdown-contnet">
                        <a href="@Url.Action("KeHoachThi", "Home")"><i title="Kế hoạch thi theo lớp" class='bx bx-calendar-check'></i> Kế hoach thi theo lớp</a>
                    </div>
                </div>
                <a href="@Url.Action("LopHoc", "Home" )" class="nav_link">
                    <i title="Lớp Học" class='bx bxs-school'></i>
                    <span class="nav_name">Lớp học</span>
                </a>
                <a href="@Url.Action("CaNhan", "Home" )" class="nav_link">
                    <i title="Cá nhân" class='bx bx-user nav_icon'></i>
                    <span class="nav_name">Cá nhân</span>
                </a>
                <div class="dropdown">
                    <button class="dropbtn">
                        <a href="@Url.Action("DangKyHP", "Home" )" class="nav_link  active">
                            <i title="Đăng ký học phần" class='bx bx-bookmark nav_icon'></i>
                            <span class="nav_name">Đăng ký học phần</span>
                        </a>
                    </button>
                    <div class="dropdown-contnet dis-block">
                        <a href="@Url.Action("TinhHinhDangKyHP", "Home")"><i title="Tình hình ĐK học phần" class='bx bxs-bookmark'></i> Tình hình ĐK học phần</a>
                        <a href="@Url.Action("KhungChuongTrinh", "Home")"><i title="Khung chương trình" class='bx bxs-book-bookmark'></i> Khung chương trình</a>
                        <a href="@Url.Action("KhungChuongTrinhKy", "Home")"><i title="Khung chương trình (Kỳ)" class='bx bxs-book-bookmark'></i> Khung chương trình (Kỳ)</a>
                    </div>
                </div>
                <a href="@Url.Action("DanhGiaRenLuyen", "Home" )" class="nav_link">
                    <i title="Đánh giá rèn luyện" class='bx bx-bar-chart-alt-2 nav_icon'></i>
                    <span class="nav_name">Đánh giá rèn luyện</span>
                </a>
                @*                <a href="#" class="nav_link">
                <i class='bx bx-log-out nav_icon'></i>
                <span class="nav_name">Đăng xuất</span>
                </a>*@
            </div>
        </div>
    </nav>
</div>
<!--Container Main start-->
<div class="border-page">
    <div class="Khung-CT">
        <p class="title-page">Chi tiết ngành @ViewBag.StudentInfo.IndustryName ( @ViewBag.StudentInfo.IndustryCode ) - @ViewBag.StudentInfo.CourseName ( @ViewBag.StudentInfo.CourseCode )</p>
        <div class="title-line"></div>
        <div class="table-CTKhung">
            <table style="width:100% ;padding-left: 4px">
                <tr>
                    <th style="width:15%;">Tên khoa</th>
                    <td>@ViewBag.StudentInfo.DepartmentName</td>
                </tr>
                <tr>
                    <th>Hệ đào tạo</th>
                    <td>@ViewBag.StudentInfo.TranningLevelName</td>
                </tr>
                <tr>
                    <th>Tên ngành</th>
                    <td>@ViewBag.StudentInfo.IndustryName</td>
                </tr>
                <tr>
                    <th>Mã ngành</th>
                    <td>@("CT" + ViewBag.StudentInfo.CourseIndustryID)</td>
                </tr>
                <tr>
                    <th>Mục tiêu đào tạo</th>
                    <td>
                        <p>Mục tiêu chung:</p>
                        <p>Mục tiêu về kiến thức:</p>
                        <p>Mục tiêu về kỹ năng:</p>
                        <p>Mục tiêu về thái độ:</p>
                        <p>Mục tiêu về vị trí việc làm sau tốt nghiệp:</p>
                        <p>Mục tiêu về trình độ ngoại ngữ, tin học:</p>
                    </td>
                </tr>
                <tr>
                    <th>Thời gian giảng dạy</th>
                    <td>(năm)</td>
                </tr>
                <tr>
                    <th>Khối lượng kiến thức toàn khóa</th>
                    <td>@ViewBag.StudentInfo.Credits (tín chỉ)</td>
                </tr>
                <tr>
                    <th>Đối tượng tuyển sinh</th>
                    <td></td>
                </tr>
                <tr>
                    <th>Quy trình đào tạo, điều kiện tốt nghiệp</th>
                    <td></td>
                </tr>
                <tr>
                    <th>Điều kiện văn bản bằng chứng chỉ xét tốt nghiệp</th>
                    <td></td>
                </tr>
                <tr>
                    <th>Thang điểm</th>
                    <td></td>
                </tr>
                <tr>
                    <th>Khung chương trình</th>
                    <td>
                        <div class="table-con">
                            <table style="width:100%; margin-top: 5px;">
                                <thead>
                                    <tr>
                                        <!-- Hàng 1-->
                                        <th style="width:3%" rowspan="2">STT</th>
                                        <th style="width:7%" rowspan="2">Mã học phần</th>
                                        <th rowspan="2">Tên học phần</th>
                                        <th style="width:6%" colspan="3">Số tín chỉ</th>
                                        <th  colspan="5">Loại giờ tín chỉ</th>
                                        <th style="width:4%" rowspan="2">Học kỳ</th>
                                        <th style="width:8%" rowspan="2">Kiểu học phần</th>
                                        <th style="width:14%" colspan="2">Học phần (theo mã)</th>
                                    </tr>
                                    <tr class="clo-2">
                                        <td></td>
                                        <td>LT</td>
                                        <td>TH</td>
                                        <td style="width:7%; text-align: center;">Lý thuyết</td>
                                        <td style="width:7%; text-align: center;">Bài tập</td>
                                        <td style="width:7%; text-align: center;">Thảo luận</td>
                                        <td style="width:7%; text-align: center;">Thực hành thí nghiệm, điền dã, studio</td>
                                        <td style="width:7%; text-align: center;">Hướng dẫn sinh viên tự học</td>
                                        <td style="width:5%;">Tiên quyết</td>
                                        <td style="width:5%;">Học trước</td>
                                    </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <!-- Hàng 3 trờ đi dựa vao thứ tự của hàng 1 và 2-->
                                    <td colspan="11"><strong>I. Kiến thức giáo dục đại cương</strong></td>
                                    <td colspan="4"></td>
                                </tr>
                                @{
                                    var sttNK = 1;
                                }
                                <tr>
                                    <td><strong>I.1</strong></td>
                                    <td colspan="2"><strong>@lstype[0].TypeName.Substring(0,11)</strong></td>
                                    <td><strong>0</strong></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td><strong>Bắt buộc</strong></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            
                                    @foreach(var item in lstype)
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                        <td>@(sttNK++)</td>
                                        <td>@item.ModulesCode</td>
                                        <td>@item.ModulesName</td>
                                        <td>@item.Credits</td>
                                        <td>@item.CreditsLT</td>
                                        <td>@item.CreditsTH</td>
                                        <td>@item.TimesLT</td>
                                        <td>@item.TimesBT</td>
                                        <td>@item.TimesTL</td>
                                        <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                        <td>@item.SemesterID</td>
                                        <td></td>
                                        <td>
                                           @Html.Raw(item.ModulesTQ)
                                        </td>
                                        <td>@Html.Raw(item.ModulesHT)</td>
                                    </tr>
                                    }
                                    @{
                                        var sttTC = 1;
                                        var sttTC2 = 0;
                                    }
                                    <tr>
                                        <td><strong>I.2</strong></td>
                                        <td colspan="2"><strong>@lstype2[0].TypeName.Substring(3)</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td><strong>Có tự chọn</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3"><strong>Kiến thức bắt buộc</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    @foreach (var item in lstype2.Where(x=>x.ProgramGroupID==0))
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttTC++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td><strong>Bắt buộc</strong></td>
                                            <td>@item.SemesterID</td>
                                            <td>@item.TimesK</td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <td colspan="3"><strong>Tự chọn thể chất</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    @foreach (var item in lstype2.Where(x => x.ProgramGroupID != 0))
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttTC2++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    @{
                                        var sttQP = 1;
                                    }
                                    <tr>
                                        <td><strong>I.3</strong></td>
                                        <td colspan="2"><strong>@lstype3[0].TypeName.Substring(3)</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td><strong>Bắt buộc</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    @foreach (var item in lstype3)
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttQP++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    @{
                                        var sttCT = 1;
                                    }
                                    <tr>
                                        <td><strong>I.4</strong></td>
                                        <td colspan="2"><strong>@lstype4[0].TypeName</strong></td>
                                        <td><strong>11</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td><strong>Bắt buộc</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    @foreach (var item in lstype4)
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttCT++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                               @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    @{
                                        var sttDC = 1;
                                    }
                                    <tr>
                                        <td><strong>I.5</strong></td>
                                        <td colspan="2"><strong>@lstype5[0].TypeName</strong></td>
                                        <td><strong>15</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td><strong>Bắt buộc</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    @foreach (var item in lstype5)
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                       
                                        <tr>
                                            <td>@(sttDC++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <!-- Hàng 3 trờ đi dựa vao thứ tự của hàng 1 và 2-->
                                        <td colspan="11"><strong>II. KIẾN THỨC GIÁO DỤC CƠ SỞ NGHÀNH</strong></td>
                                        <td colspan="4"></td>
                                    </tr>
                                    @{
                                        var sttCSN = 1;
                                    }
                                    <tr>
                                        <td><strong>II.1</strong></td>
                                        <td colspan="2"><strong>@lstype6[0].TypeName</strong></td>
                                        <td><strong>50</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td><strong>Có tự chọn</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3"><strong>Kiến thức bắt buộc</strong></td>
                                        <td><strong>35</strong></td>
                                        <td><strong>35</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    @foreach (var item in lstype6.Where(x=>x.ProgramGroupID==0))
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttCSN++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                               @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <td colspan="3"><strong>Tự chọn cơ sở ngành</strong></td>
                                        <td><strong>15</strong></td>
                                        <td><strong>15</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    @{
                                        var sttCSN2 = 1;
                                    }
                                    @foreach (var item in lstype6.Where(x => x.ProgramGroupID != 0))
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttCSN2++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <!-- Hàng 3 trờ đi dựa vao thứ tự của hàng 1 và 2-->
                                        <td colspan="11"><strong>III. KIẾN THỨC GIÁO DỤC CHUYÊN NGHÀNH</strong></td>
                                        <td colspan="4"></td>
                                    </tr>
                                    @{
                                        var sttCN = 1;
                                        var sttCN2 = 1;
                                    }
                                    <tr>
                                        <td><strong>III.1</strong></td>
                                        <td colspan="2"><strong>@lstype7[0].TypeName</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td><strong>Có tự chọn</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3"><strong>Kiến thức bắt buộc</strong></td>
                                        <td><strong>16</strong></td>
                                        <td><strong>16</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    @foreach (var item in lstype7.Where(x => x.ProgramGroupID == 0))
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttCN++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <td colspan="3"><strong>Tự chọn chuyên ngành</strong></td>
                                        <td><strong>35</strong></td>
                                        <td><strong>35</strong></td>
                                        <td><strong>0</strong></td>
                                        <td><strong>0</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                     @foreach (var item in lstype7.Where(x => x.ProgramGroupID != 0))
                                    {
                                        if (item.ModulesHT != null)
                                        {
                                            string input = item.ModulesHT;
                                            string pattern = @"\b(\d+)\b"; // Mẫu Regex để tìm các chuỗi số

                                            // Sử dụng Regex.Matches để tìm tất cả các khớp trong chuỗi
                                            MatchCollection matches = Regex.Matches(input, pattern);

                                            string lastMatchValue = null;
                                            string result = "";

                                            // Duyệt qua từng khớp và lược bỏ các giá trị giống nhau, chỉ giữ lại giá trị cuối cùng
                                            foreach (Match match in matches)
                                            {
                                                string currentValue = match.Groups[1].Value;
                                                if (currentValue != lastMatchValue)
                                                {
                                                    result += currentValue + ", ";
                                                    lastMatchValue = currentValue;
                                                }
                                            }

                                            // Loại bỏ dấu phẩy cuối cùng và khoảng trắng
                                            item.ModulesHT = result.TrimEnd(',', ' ');
                                        }
                                        <tr>
                                            <td>@(sttCN2++)</td>
                                            <td>@item.ModulesCode</td>
                                            <td>@item.ModulesName</td>
                                            <td>@item.Credits</td>
                                            <td>@item.CreditsLT</td>
                                            <td>@item.CreditsTH</td>
                                            <td>@item.TimesLT</td>
                                            <td>@item.TimesBT</td>
                                            <td>@item.TimesTL</td>
                                            <td>@item.TimesTH</td>
                                            <td>@item.TimesK</td>
                                            <td>@item.SemesterID</td>
                                            <td></td>
                                            <td>
                                                @Html.Raw(item.ModulesTQ)
                                            </td>
                                            <td>@Html.Raw(item.ModulesHT)</td>
                                        </tr>
                                    }
                                    <tr>
                                        <td colspan="3"><strong>Tổng số tín chỉ</strong></td>
                                        <td><strong>@ViewBag.StudentInfo.Credits</strong></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>

